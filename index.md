# üìä Proyecto Final ‚Äì Indicador de Participaci√≥n de Cr√©ditos del BCP

## üè¶ Banco de Cr√©dito del Per√∫ (BCP)

El Banco de Cr√©dito del Per√∫ (BCP) es el banco m√°s grande y antiguo del sistema financiero peruano, con m√°s de 130 a√±os de operaci√≥n y liderazgo en colocaciones y dep√≥sitos a nivel nacional. Forma parte del holding financiero Credicorp y atiende a millones de clientes en personas, pymes y empresas, combinando una amplia red f√≠sica con canales digitales como banca por internet, banca m√≥vil y billeteras digitales como Yape.  

Este proyecto se centra en un **indicador estrat√©gico** que mide la participaci√≥n del BCP en el mercado de cr√©ditos en moneda nacional.

---

## üß∑ Planteamiento del Business Case

Al **31 de mayo de 2025**, el **indicador mensual de participaci√≥n del BCP en el monto total de cr√©ditos otorgados en soles por el sistema bancario peruano** se encuentra en **33.4 %**, clasificado como **sem√°foro amarillo**.  

La meta del business case es que, para el **31 de mayo de 2026**, este indicador se eleve a **36.0 %** (**sem√°foro verde**), reforzando el **liderazgo del BCP en el mercado de colocaciones en moneda nacional**.

---

### üéØ Objetivo del Business Case

Incrementar la participaci√≥n del BCP en el monto total de cr√©ditos otorgados en soles por el sistema bancario peruano:

- **Situaci√≥n actual (may-2025):** 33.4 %  
- **Meta (may-2026):** 36.0 %  
- **Prop√≥sito estrat√©gico:**  
  - Fortalecer el posicionamiento del BCP como banco l√≠der en cr√©ditos en moneda nacional.  
  - Sostener el crecimiento rentable de la cartera, con foco en segmentos de alto potencial.

---

### üß© Estrategia Propuesta

Para alcanzar el objetivo, se plantea una **campa√±a nacional de colocaciones preferenciales** orientada a:

- **Mypes** y **cr√©ditos de consumo** en regiones con menor bancarizaci√≥n.
- Ofertas con **condiciones competitivas** (tasas, plazos y productos).
- **Alianzas con fintechs y canales digitales** para ampliar alcance y capilaridad.
- **Campa√±as de educaci√≥n financiera, publicidad y ferias de cr√©dito** en zonas estrat√©gicas.
- **Bonos por desempe√±o** para asesores comerciales de regiones objetivo.
- **Recompra de cr√©ditos** de clientes actuales para mejorar condiciones y fidelizaci√≥n.

En conjunto, la estrategia busca **aumentar colocaciones**, **profundizar la relaci√≥n con clientes** y **expandir la presencia del BCP** en regiones con oportunidad de crecimiento.

---

### üí∞ Costo‚ÄìBeneficio Esperado

- **Inversi√≥n √∫nica estimada:**  
  - Aproximadamente **S/ 50 millones**, principalmente en campa√±as publicitarias y refuerzo del equipo comercial en campo.
- **Beneficio esperado (escenario de √©xito):**  
  - **Facturaci√≥n adicional mensual estimada:** ~**S/ 9.34 millones** por intereses y comisiones.  
  - **Impacto en el primer a√±o:** alrededor de **S/ 112 millones adicionales** si se sostiene el nuevo nivel del indicador.  

M√°s all√° del impacto financiero directo, la estrategia tambi√©n fortalece la **fidelizaci√≥n de clientes**, la **posici√≥n competitiva del BCP** y la **confianza del mercado** en la gesti√≥n del banco.

---

## üìä Indicador Clave (KPI) del Proyecto

### üè∑Ô∏è Nombre del Indicador

**Indicador mensual de participaci√≥n del BCP en el monto total de cr√©ditos otorgados en soles por el sistema bancario peruano.**

---

### üßæ Definici√≥n

Este indicador mide el **porcentaje de participaci√≥n del BCP** en el total de cr√©ditos otorgados en moneda nacional (soles) por todas las entidades bancarias supervisadas en el pa√≠s.  

Incluye cr√©ditos de:

- Consumo  
- Hipotecarios  
- Empresas (mipymes y grandes empresas)

---

### üìê F√≥rmula

**Participaci√≥n BCP (%) = (Cr√©ditos del BCP en soles) / (Cr√©ditos totales del sistema bancario en soles)**
\]

El resultado se expresa en **porcentaje (%)**.

- **Moneda:** Porcentaje (%)  
- **Frecuencia:** Mensual  

---

### üìâ Impacto Econ√≥mico de 1 punto porcentual (pp)

En el contexto del business case, una variaci√≥n de **1 pp** en la participaci√≥n del BCP en el mercado de cr√©ditos en soles representa del orden de **millones de soles en colocaciones mensuales adicionales o perdidas**.  

Por ello, moverse de **33.4 %** a **36.0 %** no solo es un cambio de color en el sem√°foro, sino una diferencia relevante en **ingresos por intereses y comisiones** y en la **cuota de mercado** del banco.

---

### üö¶ Rangos de Desempe√±o (Sem√°foro)

- üü¢ **Verde:**  
  - Participaci√≥n **‚â• 36 %**  
  - Nivel √≥ptimo de liderazgo y crecimiento del portafolio.
- üü° **Amarillo:**  
  - Participaci√≥n entre **30 % y < 36 %**  
  - Zona de alerta: liderazgo a√∫n vigente, pero con espacio de mejora y riesgo de p√©rdida de mercado.
- üî¥ **Rojo:**  
  - Participaci√≥n **< 30 %**  
  - Zona cr√≠tica: deterioro significativo del posicionamiento competitivo.

---

## üéØ Objetivos del Proyecto de Anal√≠tica y Visualizaci√≥n

El proyecto de Data Visualization tiene como prop√≥sito **traducir este business case en una soluci√≥n anal√≠tica completa**, que permita a la gerencia monitorear, explicar y accionar sobre el KPI.

### Objetivo General

Dise√±ar y desplegar una soluci√≥n de **anal√≠tica y visualizaci√≥n de datos** que permita **seguir mensualmente el indicador de participaci√≥n de cr√©ditos del BCP**, evaluar el impacto de la campa√±a y soportar la toma de decisiones comerciales y estrat√©gicas.

### Objetivos Espec√≠ficos

- **Integrar fuentes de datos internas y externas:**  
  Consolidar informaci√≥n de colocaciones del BCP y del sistema financiero (por producto, segmento, regi√≥n, etc.).

- **Automatizar el c√°lculo del KPI:**  
  Implementar procesos ETL y modelos de datos que calculen el indicador en forma **consistente, trazable y reproducible**.

- **Dise√±ar un modelo de datos de negocio:**  
  Construir un modelo sem√°ntico que permita analizar el KPI por **segmento, regi√≥n, canal, producto, tipo de campa√±a, etc.**

- **Desarrollar dashboards con enfoque de storytelling:**  
  Crear reportes que respondan de forma clara al esquema **‚ÄúWhat? ‚Äì So What? ‚Äì Now What?‚Äù**, mostrando:
  - Situaci√≥n actual del indicador  
  - Brechas frente a la meta  
  - Impacto econ√≥mico  
  - Acciones recomendadas

- **Habilitar an√°lisis de drill-through y detalle:**  
  Permitir que usuarios de negocio naveguen desde vistas ejecutivas hasta el detalle de clientes, productos o regiones.

---

## ‚ú® Resultados Esperados para el Negocio

Con la soluci√≥n anal√≠tica implementada, se espera:

- **Monitoreo estrat√©gico continuo** del KPI, con visibilidad mensual de avances hacia la meta del **36 %**.  
- **Identificaci√≥n temprana de desviaciones** por regi√≥n, segmento o producto, permitiendo ajustar campa√±as en tiempo real.  
- **Medici√≥n clara del retorno de la inversi√≥n (ROI)** de la campa√±a de colocaciones preferenciales.  
- **Alineamiento entre √°reas comerciales, riesgos y planeamiento**, al trabajar con una **misma versi√≥n de la verdad**.  
- Mayor **capacidad de explicar resultados a la alta direcci√≥n**, con reportes claros, trazables y visualmente consistentes.

---
# ‚òÅÔ∏è Soluci√≥n de Negocio Cloud con Microsoft Fabric, Power BI y Azure
## ‚ú® Arquitectura de Datos Moderna para el BCP

Este proyecto implementa una soluci√≥n de anal√≠tica moderna en la nube, dise√±ada para integrar m√∫ltiples fuentes de datos, automatizar procesos ETL y habilitar dashboards ejecutivos que permitan monitorear y accionar sobre el indicador de participaci√≥n de cr√©ditos del BCP.

La arquitectura combina herramientas robustas, escalables y de clase empresarial, asegurando integridad del dato, gobernanza y capacidad de an√°lisis en tiempo real.

üß© Componentes Principales de la Soluci√≥n

a) Microsoft Fabric Warehouse & Data Factory:
Plataforma unificada para orquestar, transformar y consolidar datos empresariales, integrando procesos ETL eficientes.

b) Azure SQL (Staging Layer):
Base de datos estructurada en la nube utilizada como zona de staging para alojar datos transaccionales, fuentes SBS y registros hist√≥ricos.

c) Power BI (Visualizaci√≥n & Modelo Sem√°ntico):
Motor anal√≠tico donde se construye el modelo de negocio, se crean medidas DAX y se dise√±an dashboards ejecutivos con storytelling.

d) Excel / Procesos Operativos:
Canal de entrada y revisi√≥n operativa que permite realizar cargas menores, validaciones o lectura r√°pida de datasets espec√≠ficos.

e) Usuarios Finales / Direcci√≥n / Gesti√≥n Comercial
Reciben la visualizaci√≥n final del KPI, con capacidad de drill-down, comparativos, tendencias e interpretaci√≥n bajo el marco
What? ‚Äì So What? ‚Äì Now What?



## üß± Arquitectura de Datos

En la siguiente secci√≥n se describe la **arquitectura de datos** propuesta para soportar el business case, incluyendo las capas de datos, ETL, almacenamiento y presentaci√≥n.

![Arquitectura de Datos](05-Diagrama-Arquitectura/Arquitectura_soluci√≥n.png)

# üíæ CAPA DE DATOS

## 1. Creaci√≥n de tablas (DDL)

Esta capa contiene la definici√≥n del modelo relacional implementado para soportar el c√°lculo del indicador de participaci√≥n del BCP. Incluye las tablas transaccionales, tablas dimensionales y tablas de referencia provenientes de fuentes internas (BCP) y externas (SBS).

A continuaci√≥n se muestran ejemplos de c√≥digo SQL utilizado para crear las tablas principales del modelo.

### 1.1. Tabla de hechos: DVG3_Desembolsos

```sql
CREATE TABLE dbo.DVG3_Desembolsos (
    DesembolsoID        INT           IDENTITY(1,1) PRIMARY KEY,
    SolicitudID         INT           NOT NULL,
    Fecha               DATE          NOT NULL,
    MontoDesembolsado   DECIMAL(18,2) NOT NULL,
    Tasa                DECIMAL(5,2)  NULL,
    PlazoMeses          INT           NULL,
    NroCuotas           INT           NULL,
    EntidadReceptoraID  INT           NULL
);

CREATE TABLE dbo.DVG3_Solicitudes (
    SolicitudID     INT           IDENTITY(1,1) PRIMARY KEY,
    ClienteID       INT           NOT NULL,
    ProductoID      INT           NOT NULL,
    CanalID         INT           NOT NULL,
    EjecutivoID     INT           NOT NULL,
    SegmentoID      INT           NOT NULL,
    MonedaID        INT           NOT NULL,
    EstadoID        INT           NOT NULL,
    FechaEnvio      DATE          NOT NULL,
    MontoSolicitado DECIMAL(18,2) NOT NULL,
    DocCompleto     BIT           NOT NULL
);

CREATE TABLE dbo.DVG3_Cliente (
    ClienteID     INT          PRIMARY KEY,
    TipoCliente   VARCHAR(50)  NOT NULL,
    RangoEdad     VARCHAR(50)  NULL,
    RangoIngreso  VARCHAR(50)  NULL,
    Ocupacion     VARCHAR(100) NULL,
    AniosBanco    INT          NULL
);

CREATE TABLE dbo.DVG3_Region (
    RegionID      INT          PRIMARY KEY,
    NombreRegion  VARCHAR(100) NOT NULL,
    ZonaComercial VARCHAR(100) NULL
);

CREATE TABLE dbo.TargetTabla (
    AnioMes          CHAR(6)       PRIMARY KEY,      -- formato AAAAMM
    Desembolsos_S   DECIMAL(18,2) NOT NULL,
    MarketShare     DECIMAL(5,2)  NULL,
    Target_S        DECIMAL(18,2) NULL
);

CREATE TABLE dbo.DVG3_Desembolsos (
    DesembolsoID        INT           IDENTITY(1,1) PRIMARY KEY,
    SolicitudID         INT           NOT NULL,
    Fecha               DATE          NOT NULL,
    MontoDesembolsado   DECIMAL(18,2) NOT NULL,
    Tasa                DECIMAL(5,2)  NULL,
    PlazoMeses          INT           NULL,
    NroCuotas           INT           NULL,
    EntidadReceptoraID  INT           NULL
);

CREATE TABLE dbo.DVG3_Solicitudes (
    SolicitudID     INT           IDENTITY(1,1) PRIMARY KEY,
    ClienteID       INT           NOT NULL,
    ProductoID      INT           NOT NULL,
    CanalID         INT           NOT NULL,
    EjecutivoID     INT           NOT NULL,
    SegmentoID      INT           NOT NULL,
    MonedaID        INT           NOT NULL,
    EstadoID        INT           NOT NULL,
    FechaEnvio      DATE          NOT NULL,
    MontoSolicitado DECIMAL(18,2) NOT NULL,
    DocCompleto     BIT           NOT NULL
);

CREATE TABLE dbo.DVG3_Cliente (
    ClienteID     INT          PRIMARY KEY,
    TipoCliente   VARCHAR(50)  NOT NULL,
    RangoEdad     VARCHAR(50)  NULL,
    RangoIngreso  VARCHAR(50)  NULL,
    Ocupacion     VARCHAR(100) NULL,
    AniosBanco    INT          NULL
);

CREATE TABLE dbo.DVG3_Region (
    RegionID      INT          PRIMARY KEY,
    NombreRegion  VARCHAR(100) NOT NULL,
    ZonaComercial VARCHAR(100) NULL
);


CREATE TABLE dbo.DVG3_Campania (
    CampaniaID        INT           PRIMARY KEY,
    CampaniaNombre    VARCHAR(200)  NOT NULL,
    FechaInicio       DATE          NULL,
    FechaFin          DATE          NULL
);


CREATE TABLE dbo.DVG3_EntidadReceptora (
    EntidadID    INT           PRIMARY KEY,
    Nombre       VARCHAR(200)  NOT NULL
);

CREATE TABLE dbo.DVG3_Ejecutivo (
    EjecutivoID       INT           PRIMARY KEY,
    NombreEjecutivo   VARCHAR(200)  NOT NULL,
    EquipoComercial   VARCHAR(100)  NULL,
    SucursalID        INT           NULL
);

CREATE TABLE dbo.DVG3_Sucursal (
    SucursalID        INT           PRIMARY KEY,
    NombreSucursal    VARCHAR(200)  NOT NULL,
    RegionID          INT           NOT NULL
);

CREATE TABLE dbo.DVG3_Canal (
    CanalID       INT           PRIMARY KEY,
    CanalNombre   VARCHAR(200)  NOT NULL,
    TipoCanal     VARCHAR(50)   NULL
);

CREATE TABLE dbo.DVG3_Segmento (
    SegmentoID      INT          PRIMARY KEY,
    NombreSegmento  VARCHAR(200) NOT NULL
);

CREATE TABLE dbo.DVG3_Producto (
    ProductoID     INT           PRIMARY KEY,
    Nombre         VARCHAR(200)  NOT NULL,
    Modalidad      VARCHAR(100)  NULL,
    Tipo           VARCHAR(100)  NULL
);

CREATE TABLE dbo.DVG3_Moneda (
    MonedaID        INT           PRIMARY KEY,
    CodigoMoneda    VARCHAR(10)   NOT NULL,
    TipoMoneda      VARCHAR(50)   NULL
);

CREATE TABLE dbo.DVG3_SolicitudEstado (
    EstadoID           INT           PRIMARY KEY,
    DescripcionEstado  VARCHAR(200)  NOT NULL
);

CREATE TABLE dbo.DVG3_MercadoMensual (
    MercadoMensualID         INT           PRIMARY KEY,
    Fecha                    DATE          NOT NULL,
    CantidadPrestamos        INT           NULL,
    MontoTotalDesembolsado   DECIMAL(18,2) NULL
);

CREATE TABLE dbo.TargetTabla (
    AnioMes          CHAR(6)       PRIMARY KEY,      
    Desembolsos_S    DECIMAL(18,2) NOT NULL,
    MarketShare      DECIMAL(5,2)  NULL,
    Target_S         DECIMAL(18,2) NULL
);

```
### 2. DEFINICI√ìN DE RELACIONES (FOREIGN KEYS)

```sql
ALTER TABLE dbo.DVG3_Desembolsos
ADD CONSTRAINT FK_Desemb_Solicitudes
FOREIGN KEY (SolicitudID)
REFERENCES dbo.DVG3_Solicitudes (SolicitudID);

ALTER TABLE dbo.DVG3_Solicitudes
ADD CONSTRAINT FK_Sol_Cliente
FOREIGN KEY (ClienteID)
REFERENCES dbo.DVG3_Cliente (ClienteID);

ALTER TABLE dbo.DVG3_Solicitudes
ADD CONSTRAINT FK_Sol_Producto
FOREIGN KEY (ProductoID)
REFERENCES dbo.DVG3_Producto (ProductoID);

ALTER TABLE dbo.DVG3_Solicitudes
ADD CONSTRAINT FK_Sol_Canal
FOREIGN KEY (CanalID)
REFERENCES dbo.DVG3_Canal (CanalID);

ALTER TABLE dbo.DVG3_Solicitudes
ADD CONSTRAINT FK_Sol_Ejecutivo
FOREIGN KEY (EjecutivoID)
REFERENCES dbo.DVG3_Ejecutivo (EjecutivoID);

ALTER TABLE dbo.DVG3_Sucursal
ADD CONSTRAINT FK_Sucursal_Region
FOREIGN KEY (RegionID)
REFERENCES dbo.DVG3_Region (RegionID);
```
### üìå 3. INSERCI√ìN DE DATOS (DML)
### üü¶ 3.1. Dimensiones

```sql
INSERT INTO dbo.DVG3_Cliente (ClienteID, TipoCliente, RangoEdad, RangoIngreso, Ocupacion, AniosBanco)
VALUES
 (1001, 'Persona Natural', '25-34', 'S/ 3,001 - S/ 5,000', 'Empleado', 3),
 (1002, 'Persona Natural', '35-44', 'S/ 5,001 - S/ 8,000', 'Independiente', 7);

INSERT INTO dbo.DVG3_Region (RegionID, NombreRegion, ZonaComercial)
VALUES
 (1, 'Lima', 'Zona Central'),
 (2, 'Arequipa', 'Zona Sur'),
 (3, 'Piura', 'Zona Norte');

```

### üü¶ 3.2. Solicitudes

```sql
INSERT INTO dbo.DVG3_Solicitudes
 (ClienteID, ProductoID, CanalID, EjecutivoID, SegmentoID, MonedaID, EstadoID, FechaEnvio, MontoSolicitado, DocCompleto)
VALUES
 (1001, 10, 1, 501, 1, 1, 1, '2025-05-31', 15000.00, 1),
 (1002, 20, 2, 502, 2, 1, 2, '2025-05-31', 80000.00, 0);
```

### üü¶ 3.3. Desembolsos

```sql
INSERT INTO dbo.DVG3_Desembolsos
 (SolicitudID, Fecha, MontoDesembolsado, Tasa, PlazoMeses, NroCuotas, EntidadReceptoraID)
VALUES
 (1, '2025-06-05', 15000.00, 18.50, 36, 36, 1);

```

# üöÄ CAPA ETL (Extracci√≥n, Transformaci√≥n y Carga)

La Capa ETL, implementada con Microsoft Fabric, se encarga de asegurar la calidad, periodicidad y coherencia del flujo de datos del proyecto. Aqu√≠ es donde se preparan y procesan los datos antes de ser almacenados y usados por el modelo sem√°ntico y el dashboard final.

## A. Orquestaci√≥n del Flujo de Datos: Dataflows y Pipelines

Para automatizar todo el ciclo mensual de procesamiento, se utilizan Fabric Dataflows Gen2 y Pipelines, que permiten ejecutar tareas de extracci√≥n, transformaci√≥n y carga de forma ordenada y sin intervenci√≥n manual.

A continuaci√≥n se describen las tres etapas clave:

## üîπ 1. Extracci√≥n (E)

Los Pipelines conectan directamente con la Capa de Datos SQL (DVG2), donde se encuentran las tablas transaccionales y de mercado.
En esta fase se extraen:

- Las transacciones mensuales de ventas y desembolsos.

- Los datos de comportamiento del mercado (por ejemplo, tb_mercado_mensual).

- Atributos maestros necesarios para el c√°lculo del indicador.

- El objetivo de la extracci√≥n es traer la informaci√≥n m√°s reciente y garantizar que el an√°lisis se base en el per√≠odo correcto.

## üîπ 2. Transformaci√≥n (T)

Una vez extra√≠dos, los datos pasan a un proceso de transformaci√≥n donde:

- Se limpian y validan los registros.

- Se ajustan los formatos y tipos de datos.

- Se combinan las distintas fuentes (ventas, mercado, atributos maestros).

- Se prepara la estructura base para el c√°lculo del KPI de participaci√≥n.

- En esta fase se invoca un componente adicional (Notebook Python, descrito en la secci√≥n siguiente) para ejecutar reglas de negocio avanzadas.

## üîπ 3. Carga (L)

Finalmente, los datos transformados se env√≠an al Fabric Data Warehouse, donde:

- Se almacenan como tablas de an√°lisis optimizadas.

- Se actualiza el dataset utilizado por el modelo sem√°ntico.

- Se habilita el consumo directo para Power BI y Excel.

Esta etapa garantiza que los datos queden listos para el modelado y presentaci√≥n, cumpliendo con los criterios de periodicidad mensual del proyecto.


### üêç B. Automatizaciones en Python (Notebooks)

Como parte del proceso ETL, se implement√≥ un Notebook de Python en Microsoft Fabric encargado de automatizar el c√°lculo mensual del KPI central del proyecto:
el porcentaje de participaci√≥n del BCP en el total de cr√©ditos desembolsados en soles por el sistema financiero peruano.

Esta automatizaci√≥n permite que, cada mes, el sistema procese los datos de forma aut√≥noma, asegurando consistencia, periodicidad y reducci√≥n de esfuerzos manuales.

‚öôÔ∏è Objetivo de la Automatizaci√≥n

El prop√≥sito del Notebook es:


üéØ Extraer la informaci√≥n mensual de desembolsos del BCP desde la tabla DVG3_Desembolsos.

üéØ Extraer el volumen total del mercado de cr√©ditos desde DVG3_MercadoMensual.

üéØ Consolidar ambos conjuntos de datos.

üéØ Calcular el indicador (Market Share).

üéØ Cargar los resultados procesados en la tabla de resultados TargetTabla.

Este indicador es el que se visualiza posteriormente en Power BI para monitorear el avance hacia la meta establecida para el Business Case.

üîÑ Flujo L√≥gico de la Automatizaci√≥n

El proceso automatizado sigue la siguiente secuencia:

1Ô∏è‚É£ Extracci√≥n de Datos

El Notebook se conecta al Lakehouse/SQL para leer:

Los desembolsos mensuales del BCP desde DVG3_Desembolsos.

El total de cr√©ditos desembolsados en el sistema financiero peruano desde DVG3_MercadoMensual.

Ambas tablas contienen una columna de fecha, lo que permite agrupar la informaci√≥n por per√≠odo mensual.

2Ô∏è‚É£ Transformaci√≥n y C√°lculo del KPI

El Notebook:

Construye la clave temporal AnioMes en formato AAAAMM.

Agrupa los desembolsos del BCP por mes.

Agrupa los desembolsos totales del mercado por mes.

Calcula el KPI de participaci√≥n:

**Participaci√≥n de mercado (%) = (Cr√©ditos del BCP en soles) / (Cr√©ditos totales del sistema bancario en soles)**

Este c√°lculo queda encapsulado dentro de un proceso automatizado, eliminando la necesidad de c√°lculos manuales o intervenci√≥n del analista.


3Ô∏è‚É£ Carga del Resultado en la Tabla TargetTabla

Una vez obtenido el KPI:

Se genera un DataFrame final con las columnas:

AnioMes

Desembolsos_S (BCP)

MarketShare (%)

Target_S (opcional, meta del indicador)

Este resultado se sobreescribe o actualiza en la tabla TargetTabla.

Esta tabla es consumida directamente en Power BI para generar visualizaciones del indicador.

‚è±Ô∏è 4Ô∏è‚É£ Orquestaci√≥n Autom√°tica en Fabric

El Notebook es ejecutado de forma programada mediante un Pipeline de Microsoft Fabric, configurado para correr mensualmente.
De esta manera, el c√°lculo del KPI, la actualizaci√≥n del dataset, la disponibilidad en Power BI, se generan de forma autom√°tica, sin dependencia del usuario.


Con lo anteriormente explicado, se presenta el c√≥digo usado.

```python

from pyspark.sql import functions as F

# 1. Lectura de tablas desde el Lakehouse / SQL
desemb = spark.read.table("dbo.DVG3_Desembolsos")
mercado = spark.read.table("dbo.DVG3_MercadoMensual")

# 2. Construir clave AnioMes (AAAAMM)
desemb = (
    desemb
    .withColumn("AnioMes", F.date_format(F.col("Fecha"), "yyyyMM"))
    .groupBy("AnioMes")
    .agg(F.sum("MontoDesembolsado").alias("Desembolsos_S"))
)

mercado = (
    mercado
    .withColumn("AnioMes", F.date_format(F.col("Fecha"), "yyyyMM"))
    .groupBy("AnioMes")
    .agg(F.sum("MontoTotalDesembolsado").alias("Desembolsos_Mercado"))
)

# 3. C√°lculo del Market Share
kpi = (
    desemb
    .join(mercado, on="AnioMes", how="inner")
    .withColumn(
        "MarketShare",
        F.round(F.col("Desembolsos_S") / F.col("Desembolsos_Mercado") * 100, 2)
    )
    .withColumn("Target_S", F.lit(None).cast("decimal(18,2)"))  # meta opcional
)

# 4. Escritura en tabla de resultado
#    (en Fabric puedes usar saveAsTable / overwrite / merge seg√∫n tu dise√±o)
kpi.write.mode("overwrite").saveAsTable("dbo.TargetTabla")

```
‚≠ê Resultado Final

Gracias a esta automatizaci√≥n:

‚úÖ El an√°lisis del KPI es consistente mes a mes.

‚úÖ Se minimizan errores manuales.

‚úÖ Se refuerza la trazabilidad y gobernanza de datos.

‚úÖ Se integra sin fricci√≥n con el Data Warehouse y Power BI.

---

# üß± CAPA DE ALMACENAMIENTO (Data Warehouse)

La Capa de Almacenamiento consolida los datos ya transformados en Fabric y expone un **modelo anal√≠tico optimizado** para Power BI.  
Aqu√≠ se materializan las tablas de hechos y dimensiones que dan soporte al KPI de **desembolsos de cr√©ditos del BCP**.
A continuaci√≥n se muestra la estructura f√≠sica del **Fabric Data Warehouse (DVG3)**, donde residen las tablas relacionales creadas mediante los scripts SQL de la Capa de Datos. Este entorno constituye la base estructurada sobre la cual se construye el modelo dimensional y las medidas anal√≠ticas del proyecto.

![Estructura del Data Warehouse en Fabric](03-Capa-Almacenamiento/data_warehouse.png)


---

### üó∫Ô∏è A. Modelo de Datos Final (Modelo Dimensional)

El Data Warehouse se implementa como un **modelo de estrella** centrado en la tabla de hechos de desembolsos y las dimensiones de negocio relevantes (cliente, regi√≥n, campa√±a, canal, etc.).

- ‚≠ê **Tabla de Hechos Principal:**  
  - `DVG3 Desembolsos`  
  - Contiene el detalle mensual de los **montos desembolsados**, fechas y entidad receptora.

- üß© **Tabla de Hechos de Soporte:**  
  - `DVG3 Solicitudes`  
  - Registra el flujo de solicitudes de cr√©dito (monto solicitado, estado, documentaci√≥n completa, etc.) y permite analizar conversi√≥n de solicitud ‚Üí desembolso.

- üéØ **Dimensiones de Negocio:**
  - `DVG3 Cliente` ‚Üí atributos de cliente (tipo, rango de edad, rango de ingreso, a√±os con el banco).
  - `DVG3 Region` y `DVG3 Sucursal` ‚Üí estructura geogr√°fica y comercial.
  - `DVG3 Campania` ‚Üí campa√±as comerciales asociadas a los cr√©ditos.
  - `DVG3 Canal` ‚Üí canal de colocaci√≥n (agencia, digital, etc.).
  - `DVG3 Segmento` ‚Üí segmentaci√≥n de clientes.
  - `DVG3 Producto` ‚Üí tipo de cr√©dito / producto.
  - `DVG3 Moneda` ‚Üí tipo de moneda del cr√©dito.
  - `Calendario` ‚Üí tabla de fechas que gobierna todos los an√°lisis temporales.
  - `Target Tabla` ‚Üí metas mensuales de desembolso y *market share* para comparar contra lo realizado.

- üîó **Relaciones Clave del Modelo:**
  - `DVG3 Desembolsos` se relaciona con `DVG3 Solicitudes` v√≠a **SolicitudID**, permitiendo analizar el funnel completo.
  - Todas las tablas de hechos se conectan a `Calendario[Date]`, habilitando an√°lisis **MoM, QoQ, YoY**.
  - Dimensiones como Cliente, Regi√≥n, Campa√±a y Canal se conectan en relaciones **1:N** hacia las tablas de hechos para filtrar correctamente los desembolsos.

> üñºÔ∏è **Modelo Sem√°ntico en Fabric**  
![Modelo Dimensional / Modelo Sem√°ntico](03-Capa-Almacenamiento/modelo_semantico.png)



---

### üìä B. Medidas Clave en el Modelo (DAX)

A continuaci√≥n se documentan las principales medidas DAX creadas sobre el modelo.  
Todas ellas se definen en la tabla de medidas **`_Medidas`** dentro del modelo sem√°ntico.

#### 1Ô∏è‚É£ Medidas base de desembolsos
```dax

‚úÖ Dese PROM ‚Äì Monto promedio desembolsado

> Promedio del monto desembolsado en el contexto actual de filtro.

Dese PROM =
AVERAGE ( 'DVG3 Desembolsos'[Monto_desembolsado] )
```

```dax
‚úÖ Dese SUM ‚Äì Monto total desembolsado

Suma total del monto desembolsado en el periodo/contexto analizado.

Dese SUM =
SUM ( 'DVG3 Desembolsos'[Monto_desembolsado] )
```
2Ô∏è‚É£ Comparaciones temporales (MoM, QoQ, YoY)

```dax
‚úÖ Dese SUM PM ‚Äì Desembolsos del mes previo

Total desembolsado desplazado un mes hacia atr√°s usando la tabla Calendario.

Dese SUM PM =
CALCULATE (
    [Dese SUM],
    DATEADD ( Calendario[Date], -1, MONTH )
)
```
```dax
‚úÖ Dese SUM PQ ‚Äì Desembolsos del trimestre previo

Dese SUM PQ =
CALCULATE (
    [Dese SUM],
    DATEADD ( Calendario[Date], -1, QUARTER )
)
```
```dax
‚úÖ Dese SUM PY ‚Äì Desembolsos del a√±o previo

Dese SUM PY =
CALCULATE (
    [Dese SUM],
    DATEADD ( Calendario[Date], -1, YEAR )
)

```
```dax
‚úÖ Dese SUM MoM ‚Äì Variaci√≥n % Mes vs Mes Anterior

Crecimiento (o ca√≠da) porcentual de los desembolsos respecto al mes anterior.

Dese SUM MoM =
DIVIDE (
    [Dese SUM] - [Dese SUM PM],
    [Dese SUM PM]
)
```
```dax
‚úÖ Dese SUM QoQ ‚Äì Variaci√≥n % Trimestre vs Trimestre Anterior

Dese SUM QoQ =
DIVIDE (
    [Dese SUM] - [Dese SUM PQ],
    [Dese SUM PQ]
)
```
```dax
‚úÖ Dese SUM YoY ‚Äì Variaci√≥n % A√±o vs A√±o Anterior

Dese SUM YoY =
DIVIDE (
    [Dese SUM] - [Dese SUM PY],
    [Dese SUM PY]
)
```
3Ô∏è‚É£ Medidas de soporte al an√°lisis temporal


```dax
‚úÖ Desembolsos mensuales ‚Äì Serie limpia por mes

Reconstruye la serie de desembolsos mes a mes usando las fechas de la tabla Calendario, garantizando alineamiento entre calendario y hechos.

Desembolsos mensuales =
VAR FechasMes =
    VALUES ( 'Calendario'[Date] )
RETURN
CALCULATE (
    SUM ( 'DVG3 Desembolsos'[Monto_desembolsado] ),
    TREATAS ( FechasMes, 'DVG3 Desembolsos'[Fecha] )
)
```
4Ô∏è‚É£ Metas y benchmark de negocio

üéØ Target mensual S/ ‚Äì Meta mensual de desembolsos

Asigna una meta fija de desembolsos solo para el rango de fechas del proyecto (entre mayo 2025 y mayo 2027).
Fuera de ese rango, la medida devuelve BLANK().

```dax
Target mensual S/ =
VAR mIni =
    DATE (
        YEAR ( MIN ( 'Calendario'[Date] ) ),
        MONTH ( MIN ( 'Calendario'[Date] ) ),
        1
    )
RETURN
IF (
    NOT ISBLANK ( mIni )
        && mIni >= DATE ( 2025, 5, 1 )
        && mIni <= DATE ( 2027, 5, 1 ),
    129999546,
    BLANK ()
)
```
5Ô∏è‚É£ Rankings por cliente, campa√±a y canal

ü•á Top Rank Clie ‚Äì Ranking de clientes por desembolsos

Calcula el ranking de clientes en funci√≥n del promedio de desembolsos, respetando el contexto de filtros activo (segmento, regi√≥n, campa√±a, etc.).


```dax
Top Rank Clie =
RANKX (
    ALLSELECTED ( 'DVG3 Cliente'[ClienteID] ),
    [Dese PROM],
    ,
    DESC,
    DENSE
)
```

üèÜ Top3 Rank Camp ‚Äì Ranking de campa√±as

Ranking de campa√±as seg√∫n el promedio de desembolsos. Permite identificar las campa√±as m√°s efectivas.


```dax
Top3 Rank Camp =
RANKX (
    ALLSELECTED ( 'DVG3 Campania'[CampaniaNombre] ),
    [Dese PROM],
    ,
    DESC,
    DENSE
)
```

üìà Top3 Rank Canal ‚Äì Ranking de canales

Ranking de canales comerciales por desempe√±o en desembolsos.


```dax
Top3 Rank Canal =
RANKX (
    ALLSELECTED ( 'DVG3 Canal'[CanalNombre] ),
    [Dese PROM],
    ,
    DESC,
    DENSE
)
```
# üìä Capa de Presentaci√≥n (Power BI)

La Capa de Presentaci√≥n integra todo el trabajo previo de modelado, transformaci√≥n y aseguramiento de la calidad de datos, convirti√©ndolo en una experiencia visual que permite analizar el rendimiento del BCP frente al sistema bancario peruano.

En esta secci√≥n se muestran las p√°ginas principales del reporte en Power BI, organizadas para responder las tres preguntas clave del an√°lisis de indicadores estrat√©gicos:

WHAT? ‚Üí ¬øCu√°l es el comportamiento actual del KPI?

SO WHAT? ‚Üí ¬øQu√© implicancias tiene desviarse del objetivo?

NOW WHAT? ‚Üí ¬øQu√© decisiones y acciones deben tomarse?

El reporte fue dise√±ado bajo un enfoque de claridad ejecutiva, priorizando:
‚úì Mensajes directos
‚úì M√©tricas clave
‚úì Comparaciones relevantes
‚úì Flujos de navegaci√≥n simples (pesta√±as superiores)
‚úì Uso de drill-through para profundizar en el an√°lisis mensual

A continuaci√≥n, se presentan las principales pantallas del reporte desarrollado en Power BI para el Banco de Cr√©dito del Per√∫ (BCP). Cada vista responde a una secci√≥n clave del an√°lisis: desde la introducci√≥n al caso, pasando por la definici√≥n del indicador, hasta el an√°lisis comercial y el reporte ejecutivo.


üñºÔ∏è 1. Portada del Proyecto
![Portada](./04-Capa-Presentacion/imagen1.png)


üñºÔ∏è 2. Planteamiento del Business Case
![BusinessCase](./04-Capa-Presentacion/imagen2.png)

üñºÔ∏è 3. Indicador Mensual ‚Äî Definici√≥n, F√≥rmula, Impacto y Rangos
![Indicador](./04-Capa-Presentacion/imagen3.png)

üñºÔ∏è 4. Dashboard Comercial del BCP
![Dashboard](./04-Capa-Presentacion/imagen4.png)

üñºÔ∏è 5. Reporte Ejecutivo ‚Äî What / So What / Now What
![ReporteEjecutivo](./04-Capa-Presentacion/imagen_5.png)

## üîπ Preguntas del Reporte Anal√≠tico (Power BI)

A continuaci√≥n se presentan las 10 preguntas del an√°lisis junto con sus visualizaciones principales y sus vistas de detalle (Drill Through).
Cada pregunta sigue el mismo patr√≥n:

a) Pregunta

b) Gr√°fico principal

c) Drill through (detalle)


1Ô∏è‚É£ Pregunta 1 ‚Äî Canal
¬øCu√°les son los tres tipos de canal que registraron el mayor aporte promedio en el INDICADOR MENSUAL DEL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL BCP durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 1](./04-Capa-Presentacion/imagen6.png)


Obtener detalles (Drill Through):
![Detalle P1](./04-Capa-Presentacion/imagen7.png)



2Ô∏è‚É£ Pregunta 2 ‚Äî Sucursales
¬øCu√°les son las tres Sucursales que registraron el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 2](./04-Capa-Presentacion/imagen8.png)




Obtener detalles (Drill Through):
![Detalle P2](./04-Capa-Presentacion/imagen9.png)

3Ô∏è‚É£ Pregunta 3 ‚Äî Tipo de Producto
¬øQu√© TIPO DE PRODUCTO registr√≥ el mayor impacto en el valor promedio del INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo mayo 2025 a mayo 2026?

Visualizaci√≥n principal:
![Pregunta 3](./04-Capa-Presentacion/imagen10.png)


Obtener detalles (Drill Through):
![Detalle P3](./04-Capa-Presentacion/imagen11.png)


4Ô∏è‚É£ Pregunta 4 ‚Äî Segmento
¬øCu√°l es el Top del segmento que registra el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 4](./04-Capa-Presentacion/imagen12.png)


Obtener detalles (Drill Through):
![Detalle P4](./04-Capa-Presentacion/imagen13.png)


5Ô∏è‚É£ Pregunta 5 ‚Äî Regi√≥n
¬øCu√°les son las tres regiones que registraron el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 5](./04-Capa-Presentacion/imagen14.png)

Obtener detalles (Drill Through):
![Detalle P5](./04-Capa-Presentacion/imagen15.png)


6Ô∏è‚É£ Pregunta 6 ‚Äî Canales (Detalle Alterno)
¬øCu√°les son los tres canales que registraron el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 6](./04-Capa-Presentacion/imagen16.png)

Obtener detalles (Drill Through):
![Detalle P6](./04-Capa-Presentacion/imagen17.png)


7Ô∏è‚É£ Pregunta 7 ‚Äî Tipos de Cliente
¬øCu√°les son los tres tipos de clientes que registraron el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 7](./04-Capa-Presentacion/imagen18.png)


Obtener detalles (Drill Through):
![Detalle P7](./04-Capa-Presentacion/imagen19.png)



8Ô∏è‚É£ Pregunta 8 ‚Äî Campa√±as
¬øCu√°les son las tres campa√±as que registraron el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 8](./04-Capa-Presentacion/imagen20.png)


Obtener detalles (Drill Through):
![Detalle P8](./04-Capa-Presentacion/imagen21.png)


9Ô∏è‚É£ Pregunta 9 ‚Äî Productos (Detalle Alterno)
¬øCu√°les son los tres productos que registraron el mayor aporte promedio en el INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo comprendido entre mayo de 2025 y mayo de 2026?

Visualizaci√≥n principal:
![Pregunta 9](./04-Capa-Presentacion/imagen22.png)


Obtener detalles (Drill Through):
![Detalle P9](./04-Capa-Presentacion/imagen23.png)



üîü Pregunta 10 ‚Äî Ejecutivos
¬øQui√©nes conforman el Top 3 de EJECUTIVOS que tuvieron el mayor aporte promedio en el valor del INDICADOR MENSUAL DE PARTICIPACI√ìN DEL BCP EN EL MONTO TOTAL DE CR√âDITOS OTORGADOS EN SOLES POR EL SISTEMA BANCARIO PERUANO durante el per√≠odo de mayo 2025 a mayo 2026?

Visualizaci√≥n principal:
![Pregunta 10](./04-Capa-Presentacion/imagen24.png)


Obtener detalles (Drill Through):
![Detalle P10](./04-Capa-Presentacion/imagen25.png)


<section style="padding: 60px 0; text-align: center;">
  <h2 style="font-size: 42px; font-weight: 700; margin-bottom: 10px;">Stack Tecnol√≥gico</h2>
  <div style="width: 80px; height: 4px; background:#c27b3a; margin: 0 auto 40px auto; border-radius: 2px;"></div>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 25px; width: 90%; margin: auto;">
    
    <!-- Tarjeta 1 -->
    <div style="background: #ffffff; padding: 30px; border-radius: 18px; 
                box-shadow: 0 8px 20px rgba(0,0,0,0.07); transition: 0.25s; cursor: pointer;"
         onmouseover="this.style.transform='scale(1.04)'"
         onmouseout="this.style.transform='scale(1)'">
      <img src="https://img.icons8.com/fluency/96/ms-fabric.png" width="55" />
      <h3 style="font-size:20px; margin-top: 10px;">Microsoft Fabric</h3>
      <p style="color:#555; font-size: 15px;">Ingesta, transformaci√≥n y orquestaci√≥n del flujo de datos.</p>
    </div>

    <!-- Tarjeta 2 -->
    <div style="background: #ffffff; padding: 30px; border-radius: 18px; 
                box-shadow: 0 8px 20px rgba(0,0,0,0.07); transition: 0.25s; cursor: pointer;"
         onmouseover="this.style.transform='scale(1.04)'"
         onmouseout="this.style.transform='scale(1)'">
      <img src="https://img.icons8.com/color/96/python.png" width="55" />
      <h3 style="font-size:20px; margin-top: 10px;">Python</h3>
      <p style="color:#555; font-size: 15px;">Automatizaciones, validaciones y c√°lculos ETL.</p>
    </div>

    <!-- Tarjeta 3 -->
    <div style="background: #ffffff; padding: 30px; border-radius: 18px; 
                box-shadow: 0 8px 20px rgba(0,0,0,0.07); transition: 0.25s; cursor: pointer;"
         onmouseover="this.style.transform='scale(1.04)'"
         onmouseout="this.style.transform='scale(1)'">
      <img src="https://img.icons8.com/external-flaticons-lineal-color-flat-icons/96/external-database-data-analytics-flaticons-lineal-color-flat-icons.png" width="55" />
      <h3 style="font-size:20px; margin-top: 10px;">SQL Warehouse</h3>
      <p style="color:#555; font-size: 15px;">Almacenamiento estructurado y consultas de alto rendimiento.</p>
    </div>

    <!-- Tarjeta 4 -->
    <div style="background: #ffffff; padding: 30px; border-radius: 18px; 
                box-shadow: 0 8px 20px rgba(0,0,0,0.07); transition: 0.25s; cursor: pointer;"
         onmouseover="this.style.transform='scale(1.04)'"
         onmouseout="this.style.transform='scale(1)'">
      <img src="https://img.icons8.com/color/96/power-bi.png" width="55" />
      <h3 style="font-size:20px; margin-top: 10px;">Power BI</h3>
      <p style="color:#555; font-size: 15px;">Dashboard estrat√©gico e insights interactivos.</p>
    </div>

    <!-- Tarjeta 5 -->
    <div style="background: #ffffff; padding: 30px; border-radius: 18px; 
                box-shadow: 0 8px 20px rgba(0,0,0,0.07); transition: 0.25s; cursor: pointer;"
         onmouseover="this.style.transform='scale(1.04)'"
         onmouseout="this.style.transform='scale(1)'">
      <img src="https://img.icons8.com/external-anggara-flat-anggara-putra/96/external-data-analytics-business-anggara-flat-anggara-putra.png" width="55" />
      <h3 style="font-size:20px; margin-top: 10px;">DAX</h3>
      <p style="color:#555; font-size: 15px;">C√°lculo de KPIs avanzados y l√≥gica de negocio.</p>
    </div>

    <!-- Tarjeta 6 -->
    <div style="background: #ffffff; padding: 30px; border-radius: 18px; 
                box-shadow: 0 8px 20px rgba(0,0,0,0.07); transition: 0.25s; cursor: pointer;"
         onmouseover="this.style.transform='scale(1.04)'"
         onmouseout="this.style.transform='scale(1)'">
      <img src="https://img.icons8.com/color/96/city-buildings.png" width="55" />
      <h3 style="font-size:20px; margin-top: 10px;">Data Warehouse</h3>
      <p style="color:#555; font-size: 15px;">Modelo dimensional optimizado para an√°lisis del KPI.</p>
    </div>

  </div>
</section>


